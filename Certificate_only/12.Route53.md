# Amazon Route 53 - Deep Dive

## 🔍 What is Route 53?

Amazon Route 53 is a **highly available and scalable Domain Name System (DNS)** web service designed to give developers and businesses a reliable way to route end users to internet applications. It also includes **domain registration**, **DNS routing**, and **health checking**.

---

## 🌍 Core Features

### ✅ Domain Registration

* Register new domain names directly through Route 53
* Supports common TLDs like .com, .org, .net, etc.
* Automatically sets up a hosted zone

### 🔎 DNS Service

* Translates human-readable names (e.g., `example.com`) into IP addresses (IPv4 or IPv6)
* Fully compliant with IPv4 and IPv6

### 🚫 Routing Policies

#### ▶ Simple Routing

* One record with one IP address

#### ▶ Weighted Routing

* Split traffic based on weight (useful for A/B testing or gradual rollouts)

#### ▶ Latency-based Routing

* Directs users to the region with the lowest latency

#### ▶ Failover Routing

* Active-passive setup
* Automatically switches to a healthy endpoint if the primary fails

#### ▶ Geolocation Routing

* Routes traffic based on user location (e.g., India vs. USA)

#### ▶ Multi-Value Answer Routing

* Returns multiple IP addresses; clients pick one randomly

---

## 🔍 Hosted Zones & Records

### Hosted Zone

* A container for DNS records for a domain
* Types: **Public** (Internet-facing) or **Private** (used with VPC)

### DNS Record Types

* **A Record**: Maps domain to IPv4 address
* **AAAA Record**: Maps domain to IPv6 address
* **CNAME**: Alias for another domain name
* **MX**: Mail server for domain
* **TXT**: Used for SPF, DKIM, etc.
* **NS**: Name servers for delegation
* **SRV**: Service-specific records (e.g., VoIP)
* **Alias**: Special Amazon record type (e.g., points to ELB, CloudFront, S3)

---

## 📊 Health Checks & Monitoring

### Health Checks

* Monitor the health of endpoints
* HTTP/HTTPS/TCP checks
* Used with **failover** or **multi-value routing**
* Supports CloudWatch alarms

### CloudWatch Integration

* Monitor DNS query volume, health check results
* Alerting via SNS or custom Lambda

---

## 🚨 Security & Access Control

* **IAM Policies**: Control who can modify DNS settings
* **Logging**: Enable query logs using CloudWatch
* **DNSSEC**: Protects from DNS spoofing (for hosted zones)
* **Private Hosted Zones**: Restrict DNS to within VPC only

---

## 💲 Pricing Model

* **Hosted Zone**: Charged per hosted zone per month
* **DNS Queries**: Charged per million queries (varies by record type)
* **Health Checks**: Charged per check per month
* **Domain Registration**: Annual fee depending on TLD

---

## 💡 Best Practices

* Use **Alias records** for AWS resources (cheaper & faster)
* Enable **health checks** for high availability
* Use **Latency-based routing** for global users
* Enable **logging** for debugging and auditing
* Use **Private Hosted Zones** for internal services

---

## 💼 Example Use Cases

* Custom domain for **Elastic Load Balancer (ELB)** or **CloudFront**
* Multi-region deployments with **Latency-based routing**
* **Failover** setup for disaster recovery
* Internal DNS for microservices in a VPC
* Blue-green deployments with **Weighted Routing**




## 🧭 Core Capabilities

* **Domain Registration**: Register and manage domain names directly.
* **DNS Routing**: Authoritative DNS service to translate domain names into IP addresses.
* **Health Checks**: Monitor endpoints and route traffic away from unhealthy ones.
* **Traffic Flow**: Use routing policies to route traffic based on geography, latency, and more.
* **Private DNS**: Host internal domain names for resources in a VPC.

---

## 🚀 DNS Migration Guide

Migrating DNS to Route 53 involves careful planning and execution to avoid downtime.

### Step-by-step DNS Migration:

1. **Create a Hosted Zone** in Route 53 matching your domain name.
2. **Recreate existing DNS records** (A, CNAME, MX, etc.) in the hosted zone.
3. **Verify correctness** of records and TTL values.
4. **Update NS Records** at your domain registrar to point to Route 53’s name servers.
5. **Monitor DNS propagation** and verify functionality.

📌 **Tips:**

* Lower TTL before switching NS records for faster rollback.
* Use Route 53 health checks during transition.

---

## 🔐 Private DNS with VPC Integration

Route 53 allows hosting private DNS zones that are only resolvable within one or more VPCs.

### Features:

* Internal name resolution for AWS resources.
* Helps with service discovery in microservices.
* Works across VPC peering and Transit Gateway (TGW).

### Setup:

1. Create a **Private Hosted Zone**.
2. Associate the Hosted Zone with one or more VPCs.
3. Add DNS records (e.g., internal services).
4. Ensure VPC DNS support is enabled (enableDnsSupport & enableDnsHostnames).

📌 **Note:** Works well with ECS, EKS, and hybrid cloud when using Route 53 Resolver endpoints.

---

## 🧪 Custom Health Check Lambda Examples

Route 53 health checks support CloudWatch alarms, but for more complex logic, use Lambda-based custom checks.

### Example Use Case:

Check if a backend API is healthy based on a custom header or auth token.

### Sample Lambda:

```python
import requests
import json

def lambda_handler(event, context):
    try:
        res = requests.get("https://api.example.com/health", headers={"Authorization": "Bearer TOKEN"})
        if res.status_code == 200:
            return {"status": "Healthy"}
        else:
            return {"status": "Unhealthy"}
    except Exception as e:
        return {"status": "Unhealthy", "error": str(e)}
```

### Integration:

* Use CloudWatch Metric + Alarm to invoke Lambda
* Trigger Route 53 failover using this custom health signal

📌 **Tip:** Combine with Route 53 Failover or Latency-based routing for high availability.

----

# Route 53 Resolver for Hybrid DNS and DNS Firewall Rule Sets

## 🔁 Route 53 Resolver for Hybrid DNS

Amazon Route 53 Resolver enables DNS resolution between AWS and on-premises networks via **hybrid cloud DNS architecture**.

### 🔹 Use Case

* Enable on-premises clients to resolve AWS-hosted domains
* Allow AWS workloads to resolve private on-premises DNS names
* Used in hybrid or multi-cloud architectures

### 🔹 Key Components

1. **Inbound Endpoints**

   * Accept DNS queries from on-premises DNS resolvers (into AWS)
   * Must associate with a VPC
   * Needs security group rules and IP addresses in specific subnets

2. **Outbound Endpoints**

   * Forward DNS queries from AWS to on-premises DNS servers
   * Configured with forwarding rules
   * Also requires IP addresses and security group associations

3. **Forwarding Rules**

   * Define which domain queries to forward and where (target IPs)
   * Can specify internal domains (e.g., `corp.local`) to be forwarded to on-prem DNS
   * Rules can be shared across accounts via Resource Access Manager (RAM)

### 🔹 Resolver Rules Association

* Rules are **associated with VPCs**
* Controls DNS resolution behavior per VPC

### 🔹 Logging

* Integrate with CloudWatch Logs or Kinesis Data Firehose
* Capture DNS query logs for security and monitoring

### 🔹 Security

* Supports encryption via TLS for hybrid DNS
* IAM controls access to manage resolver settings

### 🧩 Example Hybrid Setup

* On-prem DNS: `dns1.corp.local` (IP: 192.168.10.10)
* AWS Outbound Endpoint forwards `corp.local` queries to 192.168.10.10
* AWS Inbound Endpoint listens for `.aws.internal` queries from on-prem clients

---

## 🔥 DNS Firewall Rule Sets

Amazon Route 53 Resolver DNS Firewall protects VPC resources from DNS-based threats by inspecting and filtering DNS queries.

### 🔹 Key Concepts

1. **Rule Groups**

   * Collection of DNS firewall rules
   * Apply multiple rules to control allowed/blocked domains

2. **DNS Firewall Rules**

   * Each rule defines action (e.g., BLOCK, ALLOW, ALERT) and domain match pattern (e.g., `*.malware.com`)
   * Priority determines rule evaluation order

3. **Domain Lists**

   * Reusable sets of domain names (manually created or imported)
   * Can be referenced in multiple rules

4. **VPC Associations**

   * Rule groups must be explicitly associated with VPCs to take effect

### 🔹 Actions

* **ALLOW**: Let the DNS query through
* **BLOCK**:

  * Block with `NXDOMAIN`, `NODATA`, or `OVERRIDE` response
* **ALERT**: Log the query but allow it

### 🔹 Logging & Monitoring

* Logs sent to CloudWatch Logs, S3, or Kinesis
* Log DNS queries, actions taken, and matched rules

### 🔹 Pricing Considerations

* Charges for rules per VPC association and DNS query processing
* Domain list management is included

### 🧰 Example Use Case

* Block malware domains in `*.badsite.com`
* Allow corporate domains `corp.local`
* Alert on suspicious domains `*.proxyvpn.com`

### 🔒 Security & Governance

* Integrates with AWS Firewall Manager for policy control
* IAM permissions for rule creation and VPC associations
