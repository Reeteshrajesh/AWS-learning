# Elastic Load Balancing (ELB)

Elastic Load Balancing (ELB) automatically distributes incoming application traffic across multiple targets (EC2 instances, containers, IP addresses) in one or more Availability Zones (AZs).

---

## Types of Load Balancers

### 1. **Application Load Balancer (ALB)**

* Operates at Layer 7 (HTTP/HTTPS)
* Content-based routing: URL, host-based routing
* Supports WebSocket
* Native support for containerized applications (ECS/EKS with dynamic port mapping)
* Target types: Instance ID, IP, Lambda
* Path-based routing (e.g., `/api` to one target group, `/images` to another)

### 2. **Network Load Balancer (NLB)**

* Operates at Layer 4 (TCP, TLS, UDP)
* Extreme performance: Millions of requests per second
* Static IP support
* Preserves source IP
* Use case: Gaming, IoT, real-time systems

### 3. **Gateway Load Balancer (GWLB)**

* Operates at Layer 3 (IP)
* Used with third-party virtual appliances (e.g., firewalls, packet inspection)
* Combines transparent network gateway and load balancing
* Works with VPC endpoints (interface type)

### 4. **Classic Load Balancer (CLB)**

* Legacy option
* Operates at both Layer 4 and Layer 7
* Not recommended for new workloads

---

## Core Concepts

### Target Groups

* Logical group of targets (EC2, IPs, Lambda)
* Health checks are defined per target group
* ALB/NLB routes traffic to healthy targets only

### Listeners

* Check for connection requests from clients
* Each listener has rules to forward requests to target groups
* For ALB: Can use conditions like host/path for forwarding

### Health Checks

* Determines if targets are healthy before sending traffic
* Configurable protocol, port, path (for HTTP)
* Failures cause traffic rerouting to healthy targets

---

## Security

* Supports HTTPS termination with SSL certificates (managed by ACM)
* ALB/NLB can be placed in front of private subnets
* Security groups are used to control access
* Integration with WAF (Web Application Firewall)

---

## Integration with Auto Scaling

* ELB automatically adds/removes instances in ASG
* Health checks at ELB level ensure bad instances are removed
* Dynamic scaling becomes seamless

---

## Logging & Monitoring

### Access Logs

* Enabled for ALB and CLB (not NLB)
* Stored in S3
* Useful for debugging and traffic analysis

### CloudWatch Metrics

* Request count, target response time, healthy/unhealthy hosts

### AWS X-Ray

* ALB integrates with X-Ray for tracing

---

## Pricing

* Based on:

  * Hours load balancer runs
  * Number of LCU (Load Balancer Capacity Units)
  * Data processed

---

## Use Cases

* Web applications with HTTP/HTTPS (ALB)
* Microservices and container workloads (ALB)
* Real-time, latency-sensitive apps (NLB)
* Third-party firewall/VPN appliances (GWLB)

---

## Key Differences Summary

| Feature               | ALB             | NLB             | GWLB              | CLB      |
| --------------------- | --------------- | --------------- | ----------------- | -------- |
| Layer                 | 7 (HTTP/HTTPS)  | 4 (TCP/UDP/TLS) | 3 (IP)            | 4 & 7    |
| Content-Based Routing | Yes             | No              | No                | Basic    |
| WebSocket Support     | Yes             | No              | No                | Limited  |
| SSL Termination       | Yes             | Yes             | No                | Yes      |
| Static IP             | No              | Yes             | Yes               | No       |
| Target Types          | EC2, IP, Lambda | EC2, IP         | ENIs (appliances) | EC2 only |



# üìä Request Flow Diagrams

### üìò Application Load Balancer (ALB)

```
Client
  ‚Üì
ALB Listener (port 80/443, HTTP/HTTPS)
  ‚Üì (Routing rule based on Host/Path/Header)
Target Group (EC2 / ECS / Lambda)
  ‚Üì
Application Response
```

### üìó Network Load Balancer (NLB)

```
Client
  ‚Üì
NLB Listener (port 80/443/TCP/UDP)
  ‚Üì
Target Group (EC2 or IP)
  ‚Üì
Application Response
```

### üìô Gateway Load Balancer (GWLB)

```
Client
  ‚Üì
GWLB
  ‚Üì
Appliance VPC (Firewall, IDS, etc.)
  ‚Üì
Back to GWLB ‚Üí Destination VPC
```



# ‚úÖ Document Title: **Detailed Comparison of ELB Types & Their Components**

---

## üöÄ ELB Types Explained in Detail

### 1. **Application Load Balancer (ALB)**

**Layer**: 7 (Application Layer)
**Protocols Supported**: HTTP, HTTPS, WebSocket, HTTP/2

**Key Features**:

* Host-based and path-based routing
* Header and method-based routing
* Supports WebSockets and HTTP/2
* URL redirects and fixed responses
* Native integration with **AWS WAF** (Web Application Firewall)
* Supports **Lambda functions**, ECS, EC2, and IP targets
* Enhanced logging and AWS X-Ray integration
* Target Groups are tied to request parameters

**Best For**:

* Microservices architectures
* Web apps with advanced routing needs (e.g., `/api`, `/auth`)
* Containerized workloads with ECS or EKS

---

### 2. **Network Load Balancer (NLB)**

**Layer**: 4 (Transport Layer)
**Protocols Supported**: TCP, UDP, TLS

**Key Features**:

* Designed for **extremely high performance and low latency**
* Supports **TLS offloading** (TLS termination)
* **Preserves the source IP**, helpful for backend logging and firewall rules
* Static IP support + Elastic IP support
* Health checks at TCP level (or HTTP if configured)
* Integrated with PrivateLink
* Ideal for sudden burst traffic (millions of requests/sec)

**Best For**:

* Financial systems
* Real-time apps like VoIP, gaming, chat
* Legacy TCP-based apps needing IP transparency

---

### 3. **Gateway Load Balancer (GWLB)**

**Layer**: 3/4
**Traffic Encapsulation**: GENEVE protocol
**Protocol Support**: All IP traffic

**Key Features**:

* Transparent proxying of traffic to **third-party virtual appliances**
* Deploy **firewalls, IDS, IPS, deep packet inspection** tools at scale
* **Appliance VPC** separates the inspection layer from application VPCs
* No changes needed in source/destination VPCs
* Centralized deployment with scaling and resiliency

**Best For**:

* Centralizing network security appliances (e.g., Palo Alto, Fortinet)
* Transparent traffic inspection between VPCs
* Inline packet inspection at scale

---

### 4. **Classic Load Balancer (CLB)**

**Layer**: 4 & 7 (limited support)
**Status**: Legacy ‚Äì not recommended for new use

**Key Features**:

* Simplified listener rules: one-to-one mapping
* Limited Layer 7 logic compared to ALB
* Basic health checks
* No support for host/path-based routing
* No native WAF or modern logging features

**Best For**:

* Older workloads still depending on CLB
* Legacy lift-and-shift applications

---

## üß± ELB Common Components

| **Component**          | **Description**                                                              |
| ---------------------- | ---------------------------------------------------------------------------- |
| **Listener**           | Defines protocol and port for incoming connections (e.g., HTTPS:443, TCP:80) |
| **Target Group**       | A group of EC2/IPs/Lambda/ECS tasks receiving routed traffic                 |
| **Health Checks**      | Determines availability of targets via configured protocols (TCP/HTTP/HTTPS) |
| **Rules (ALB only)**   | Allow advanced routing (host, path, headers, query strings)                  |
| **Security Groups**    | Act as firewalls for the load balancer, controlling traffic to/from it       |
| **Access Logs**        | Detailed logs of all requests processed by the load balancer                 |
| **CloudWatch Metrics** | Monitors performance and availability metrics                                |




# Core ELB Concepts and Components

This section provides detailed information about the key components used across various Elastic Load Balancer (ELB) types in AWS, including ALB, NLB, and GWLB (where applicable). Each component plays a crucial role in how traffic is received, routed, secured, and balanced across backend services.

---

## üî∑ Target Groups

Target Groups define **where and how traffic is routed** by the ELB.

### Key Points:

* A **Target Group** is a logical collection of backend targets such as:

  * EC2 instances
  * IP addresses (within VPC or on-premises via Direct Connect)
  * AWS Lambda functions (only supported with ALB)
* Each target group is associated with:

  * **Protocol & Port** (e.g., HTTP:80, HTTPS:443, TCP:3306)
  * **Health Check configuration**
* ELBs **route traffic only to healthy targets** within a group.
* A single load balancer can have **multiple target groups**, useful for path-based or host-based routing (ALB only).

### Use Case Example:

ALB routes `/api/*` to `API-TargetGroup` and `/app/*` to `Frontend-TargetGroup`.

---

## üî∂ Listeners

Listeners act as the **entry point** for client connections to the ELB.

### Key Points:

* A **Listener** is a process that checks for incoming connection requests on a specified **protocol and port** (e.g., HTTP:80, HTTPS:443).
* Upon receiving a request, the listener evaluates its **rules** to determine how to route the traffic.
* For **ALB**, listener rules support:

  * Host-based routing (e.g., `app.example.com`)
  * Path-based routing (e.g., `/admin`, `/user`)
  * Header, method, query string conditions
* For **NLB**, listener rules are simpler: they forward traffic to the specified target group.

### Example:

An HTTPS listener on ALB listens on port 443 and forwards requests to a target group based on the URL path.

---

## üü¢ Health Checks

Health Checks monitor the **availability and responsiveness** of targets.

### Key Points:

* **Configurable per target group**:

  * Protocol (HTTP, HTTPS, TCP)
  * Port (e.g., 80, 443, or traffic port)
  * Path (for HTTP/HTTPS, e.g., `/healthz`)
* Health check status determines **whether a target receives traffic**.
* **Unhealthy targets** are temporarily removed from the load balancing rotation.
* Health checks help maintain **high availability and failover** behavior.

### Example Configuration:

* Protocol: HTTP
* Port: traffic port
* Path: `/health`
* Healthy threshold: 3
* Unhealthy threshold: 2

---

## üîí Security

Security is enforced at multiple layers of the ELB.

### Key Points:

#### 1. SSL/TLS Termination (HTTPS)

* **Application Load Balancer (ALB)** and **Network Load Balancer (NLB)** support SSL termination.
* SSL certificates can be managed using **AWS Certificate Manager (ACM)**.
* ELB handles the decryption, offloading the burden from backend services.

#### 2. Placement & Access Control

* ELBs can be placed in **public or private subnets** depending on access requirements.
* Common pattern: ELB in public subnet ‚Üí targets in private subnets.
* Use **security groups** to control inbound/outbound traffic:

  * ALB: Supports security groups.
  * NLB: Does **not support security groups** (relies on target-level security).

#### 3. Web Application Firewall (WAF)

* AWS WAF integrates **only with ALB**.
* Protects against common web exploits (SQL injection, XSS, etc.)
* Supports rule-based traffic filtering (IP, GeoMatch, rate limiting, etc.)


# ELB Types and Their Core Components

This document focuses exclusively on the four types of Elastic Load Balancers (ELB) in AWS and their core components.

## 1. Application Load Balancer (ALB) ‚Äî Layer 7

### üîß Core Components:

* **Listener**:

  * Protocol: HTTP or HTTPS
  * Port: Usually 80 or 443
  * Handles host-based and path-based routing

* **Listener Rules**:

  * Conditions (e.g., Path, Host header)
  * Actions (e.g., forward to target group, redirect, fixed response)

* **Target Group**:

  * Targets: EC2, ECS, Lambda, IP
  * Health checks: Protocol, path, interval, thresholds

* **Security Group**:

  * Controls traffic to ALB

* **WAF Integration**:

  * Web Application Firewall for ALB only

* **Access Logs & Monitoring**:

  * Enabled via S3 for request-level logs
  * CloudWatch metrics and alarms

---

## 2. Network Load Balancer (NLB) ‚Äî Layer 4

### üîß Core Components:

* **Listener**:

  * Protocols: TCP, TLS, UDP, TCP\_UDP
  * Port: e.g., 80, 443, custom ports

* **Target Group**:

  * Targets: EC2, IP
  * Protocols: TCP, TLS, UDP
  * Health checks: TCP-level (default), HTTP for TCP\_HealthCheckProtocol

* **Static IP / Elastic IP**:

  * Assign static IP or Elastic IP to NLB

* **Cross-Zone Load Balancing**:

  * Enable to distribute traffic across AZs

* **Preserve Source IP**:

  * Maintains client IP for backends

* **Access Logs**:

  * Not supported (only flow logs via VPC)

---

## 3. Gateway Load Balancer (GWLB)

### üîß Core Components:

* **Gateway Load Balancer Endpoint (GWLBe)**:

  * Interface endpoint that connects the client VPC to GWLB

* **GENEVE Protocol**:

  * Used for traffic encapsulation

* **Appliance VPC**:

  * Third-party virtual appliances (e.g., firewalls, IDS)

* **Target Group**:

  * Targets: Virtual appliances registered in the appliance VPC

* **Health Checks**:

  * Ensures appliance targets are alive

* **Transparent Forwarding**:

  * GWLB is invisible to the source and destination

---

## 4. Classic Load Balancer (CLB) ‚Äî Legacy

### üîß Core Components:

* **Listeners**:

  * Protocol: HTTP/HTTPS, TCP/SSL
  * Port: 80, 443, custom

* **Back-end Instances**:

  * EC2 instances registered directly (no target groups)

* **Health Checks**:

  * HTTP/TCP-based to backends

* **Security Groups**:

  * Attached to CLB

* **Sticky Sessions (Session Affinity)**:

  * Based on cookies for HTTP or duration for TCP

* **Access Logs**:

  * Optional logging to S3

---

## Comparison Summary

| Component          | ALB                     | NLB                  | GWLB                       | CLB (Legacy)            |
| ------------------ | ----------------------- | -------------------- | -------------------------- | ----------------------- |
| Layer              | 7 (HTTP/HTTPS)          | 4 (TCP/UDP/TLS)      | 3/4 (GENEVE encapsulation) | 4 & 7                   |
| Listener Protocols | HTTP, HTTPS             | TCP, TLS, UDP        | GENEVE                     | HTTP, HTTPS, TCP, SSL   |
| Target Types       | EC2, IP, Lambda, ECS    | EC2, IP              | Virtual Appliances         | EC2 only                |
| Health Check Type  | HTTP/HTTPS              | TCP, HTTP (optional) | TCP                        | TCP/HTTP                |
| WAF Support        | ‚úÖ Yes                   | ‚ùå No                 | ‚ùå No                       | ‚ùå No                    |
| Logging            | Access Logs, CloudWatch | CloudWatch only      | VPC Flow Logs              | Access Logs, CloudWatch |

