# Amazon CloudFront - Deep Dive

## üåç What is Amazon CloudFront?

Amazon CloudFront is a fast, highly secure, and programmable **Content Delivery Network (CDN)** service offered by AWS. It delivers your web content (HTML, CSS, JS, images, videos, APIs, etc.) to users across the world with low latency and high transfer speeds by caching content at **edge locations**.

---

## üåê Key Concepts

### ‚ú® Edge Locations

* Physical data centers globally distributed.
* Cache copies of content closer to end users.

### ‚öñÔ∏è Origin

* The original location of your content, e.g.:

  * S3 bucket
  * HTTP server
  * Load balancer
  * MediaPackage

### ‚úÖ Distributions

* A configuration entity that tells CloudFront:

  * Where to fetch content (origin)
  * What behaviors to apply
  * What security settings to enforce

### üìÉ Cache Behavior

* Define how CloudFront should handle requests.
* Settings include:

  * Path pattern matching
  * Allowed HTTP methods
  * TTL (Time to Live)
  * Caching headers (Cache-Control)

---

## üîí Security Features

### ‚õì Origin Access Control (OAC)

* Restrict direct access to the origin (e.g., S3)
* Only allow requests via CloudFront

### üõ°Ô∏è HTTPS with ACM

* Use AWS Certificate Manager (ACM) to serve custom domain over HTTPS.

### üö´ WAF Integration

* Protect against common attacks: SQLi, XSS, DDoS

### üåê Signed URLs and Cookies

* Secure premium/private content with signed URLs or cookies

---

## üìà Performance

### ‚è±Ô∏è Latency Reduction

* Content is served from the nearest edge location

### üìä Compression

* CloudFront supports Gzip and Brotli for faster content delivery

### üì± Device Detection

* Customize responses based on device type (mobile, tablet, desktop)

### ‚öñÔ∏è Origin Failover

* Set up multiple origins (primary and backup)
* Improves availability and fault tolerance

---

## üíª Common Use Cases

* Delivering static website assets from S3
* Streaming video content using MediaStore or MediaPackage
* Accelerating dynamic content like APIs and web apps
* Securing and accelerating custom domains
* DDoS mitigation and secure delivery with AWS Shield + WAF
* Global application distribution with geo-based routing

---

## ‚úÖ Best Practices

*

---

## üìÅ Sample Architecture

```
User Request
   |
   v
[CloudFront Distribution]  <--- WAF (optional)
   |
   |-- Cache Hit? --> Serve content from Edge Location
   |
   |-- Cache Miss --> Forward to Origin (e.g., S3 / ALB / EC2)

Response
   ^
   |
Served from CloudFront Edge Location
```




## üß† **CloudFront Key Concepts ‚Äì Detailed Guide**

---

#### üìç 1. **Edge Locations**

* **Definition:** Physical AWS data centers worldwide that serve cached content to users with the lowest latency.
* **Purpose:** Reduces round-trip time by serving content from the closest possible location.
* **Example:** If your origin is in `us-east-1` and a user from India requests your site, CloudFront may serve cached content from an edge location in Mumbai.

---

#### üì¶ 2. **Origin**

* **Definition:** The original location where CloudFront fetches your content.
* **Supported Origins:**

  * **S3 Bucket** (e.g., static websites or images)
  * **EC2/ALB/NLB** (dynamic apps or APIs)
  * **MediaPackage/MediaStore** (video streaming)
  * **Any custom HTTP server**
* **Tip:** Use Origin Groups for failover between primary and secondary origins.

---

#### üåê 3. **Distributions**

* **Definition:** A CloudFront configuration that defines how and from where to serve content.
* **Two Types:**

  * **Web Distribution (default)**: For general web content and APIs
  * **RTMP Distribution**: Legacy support for streaming media via Adobe RTMP (deprecated in many use cases)
* **Includes:**

  * Origin settings
  * Cache behaviors
  * Logging
  * SSL/TLS certificate settings

---

#### üìú 4. **Cache Behavior**

* **Purpose:** Controls how CloudFront responds to HTTP requests for specific URL paths.
* **Key Settings:**

  * **Path Pattern Matching** (`/images/*`, `/api/*`, etc.)
  * **Viewer Protocol Policy** (`HTTP only`, `Redirect HTTP to HTTPS`, etc.)
  * **Allowed Methods** (`GET, HEAD, OPTIONS` or full CRUD)
  * **Caching Settings:** TTL values, headers, query strings
  * **Compression:** Enable Gzip/Brotli
* **Advanced:** You can add multiple behaviors with different rules for specific path patterns.

---

#### üîê 5. **Origin Access Control (OAC) & Origin Access Identity (OAI)**

* **OAC (Recommended):** Controls access to the origin via signed headers. Replaces OAI for better security and IAM integration.
* **OAI (Legacy):** Grants CloudFront permission to fetch content from private S3 buckets.
* **Why Use Them:** Prevent users from bypassing CloudFront and accessing your origin directly.

---

#### üåç 6. **Geo-Targeting**

* Serve custom content based on viewer location (continent, country, region).
* **Example:** Redirect Indian users to `/in` path automatically.
* Can be implemented via:

  * Lambda\@Edge
  * CloudFront Functions
  * Geo headers

---

#### üîë 7. **Signed URLs and Cookies**

* **Use Case:** Serve private content (e.g., paid video downloads, internal reports).
* **Signed URL:** Includes expiry time and key signature.
* **Signed Cookies:** Set of cookies to access multiple protected resources.

---

#### üõ° 8. **Integration with AWS WAF**

* Protect from:

  * SQL Injection
  * Cross-Site Scripting (XSS)
  * DDoS attacks (in combination with AWS Shield)
* Define custom web ACL rules that are evaluated before CloudFront forwards requests.

---

#### üß† 9. **CloudFront Functions vs Lambda\@Edge**

| Feature            | CloudFront Functions                               | Lambda\@Edge                      |
| ------------------ | -------------------------------------------------- | --------------------------------- |
| Execution Location | Edge location (viewer request/response)            | Multiple phases (origin & viewer) |
| Language Support   | JavaScript (ES5.1)                                 | Node.js / Python                  |
| Use Case           | Lightweight manipulation (URL rewrites, redirects) | Auth, headers, content transform  |

---

#### ‚è± 10. **Caching Explained**

* **TTL Settings:**

  * **Minimum TTL**: Short-lived dynamic data
  * **Maximum TTL**: Static assets like images/CSS
* **Invalidate Cache:** Use AWS Console or CLI:

  ```bash
  aws cloudfront create-invalidation --distribution-id YOUR_ID --paths "/*"
  ```


## üíª Common Use Cases

### 1. Delivering Static Website Assets from S3

* Host your HTML, CSS, JS, and media files in an S3 bucket.

* Serve them globally using CloudFront with caching, HTTPS, and access control.

* Useful for landing pages, product sites, documentation portals, etc.

### 2. Streaming Video Content

* Use CloudFront with AWS MediaStore or MediaPackage to deliver on-demand or live video.

* CloudFront supports protocols like HLS and DASH.

* Built-in support for video caching, signed URLs, and geo-blocking.

### 3. Accelerating Dynamic Content (APIs & Web Apps)

* Use CloudFront to cache dynamic responses from API Gateway, ALB, or EC2.

* Reduce latency for web and mobile apps.

* Can integrate with Lambda@Edge to customize responses.

#### 4. Securing & Accelerating Custom Domains

* Use a custom domain (e.g., cdn.yourdomain.com) with an SSL certificate.

* Use origin access controls and signed URLs to protect your backend.

### 5. DDoS Mitigation with AWS Shield + WAF

* Integrate AWS WAF to block malicious requests.

* CloudFront is protected by AWS Shield Standard at no additional cost.

### 6. Global Distribution with Geo-Based Routing

* Route users to different content or origins based on geographic location.

* Can be combined with Lambda@Edge for dynamic content personalization.

## ‚úÖ Best Practices

* **Use OAC instead of public S3 access ‚Äì** to restrict content delivery strictly through CloudFront.

* **Enable compression (Gzip/Brotli) ‚Äì** to reduce content size and improve load time.

* **Set appropriate TTLs and caching headers ‚Äì** for optimal caching performance.

* **Use WAF + Shield ‚Äì** for security against common and advanced attacks.

* **Use Origin Failover ‚Äì** for high availability.

* **Monitor with CloudWatch & Real-time logs ‚Äì** to track performance, errors, and abuse.

* **Secure content with Signed URLs or Cookies ‚Äì** for premium/private content.

* **Use custom error responses ‚Äì** for branding and better UX during issues.

* **Leverage Lambda@Edge ‚Äì** for request/response manipulation near the user.

* **Use Geo Restriction ‚Äì** to control who can access your content by country.

