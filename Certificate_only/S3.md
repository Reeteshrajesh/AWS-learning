# AWS S3 Deep Dive

### 🔥 Overview

Amazon S3 (Simple Storage Service) is AWS's object storage solution that provides scalable, secure, and durable storage for various use cases such as backup, archiving, content distribution, and big data analytics.

---

### ✅ Core Concepts

* **Buckets**: Containers for storing objects.
* **Objects**: Files stored in buckets along with metadata.
* **Keys**: Unique identifier for an object within a bucket.
* **Regions**: Buckets are region-specific.
* **Global namespace**: Bucket names must be globally unique.
* **Durability**: 99.999999999% (11 9s) durability.
* **Availability**: Varies by storage class (e.g., Standard offers 99.99%).

---

### 🧠 Storage Classes

1. **S3 Standard** – Frequent access.
2. **S3 Intelligent-Tiering** – Automatically moves objects between frequent/infrequent tiers.
3. **S3 Standard-IA** – Infrequent access.
4. **S3 One Zone-IA** – Infrequent access in one AZ.
5. **S3 Glacier Instant Retrieval** – For archives that require milliseconds access.
6. **S3 Glacier Flexible Retrieval** – Archives with minutes to hours retrieval.
7. **S3 Glacier Deep Archive** – Cheapest, hours to retrieve.

---

### 🔐 Security & Access Control

* **Bucket Policies** – JSON-based, control access at the bucket level.
* **IAM Policies** – Control access to S3 via IAM identities.
* **ACLs** – Legacy, fine-grained object-level access (not recommended for new setups).
* **Block Public Access** – Strong setting to prevent unintended public access.
* **Encryption**

  * **SSE-S3** – Server-side encryption with S3 managed keys.
  * **SSE-KMS** – Server-side encryption using AWS KMS.
  * **SSE-C** – Server-side encryption with customer-managed keys.
  * **Client-side encryption** – You encrypt before upload.

---

### 🚚 Lifecycle Management

* **Lifecycle Policies** allow you to:

  * Transition objects to other storage classes.
  * Expire/delete objects.
  * Abort incomplete multipart uploads.

---

### 🚀 Performance & Optimization

* **Multipart Upload** – Improves performance for uploads >100 MB.
* **Transfer Acceleration** – Uses CloudFront edge locations to speed up uploads.
* **Byte-Range Fetches** – Parallel downloads for large objects.

---

### 📦 Versioning

* Stores multiple variants of an object.
* Protects against accidental deletions/overwrites.
* Works with MFA Delete for enhanced protection.

---

### 🧪 S3 Event Notifications

* Trigger Lambda, SQS, or SNS when:

  * Object is created/deleted.
  * Multipart upload completed.

---

### 📄 Logging & Monitoring

* **Access Logs** – Log requests to the bucket.
* **CloudTrail** – Record S3 API calls.
* **CloudWatch** – Metrics and alarms.

---

### 📜 Data Consistency

* **Strong consistency** for PUT, DELETE, and LIST operations (as of Dec 2020).

---

### 🕸️ S3 Static Website Hosting

* Can serve static websites via S3 + optional CloudFront CDN.
* Enable "Static website hosting" in bucket properties.
* Requires public-read access (ACL or policy).

---

### 🛡️ S3 Access Points

* Simplify access management for shared datasets.
* Control access using IAM and VPC.

---

### 🔄 S3 Replication

* **Cross-Region Replication (CRR)** – Replicate to another region.
* **Same-Region Replication (SRR)** – For compliance within the same region.
* **Requirements**:

  * Bucket versioning must be enabled.
  * IAM permissions required.

---

### 🗃️ S3 Object Lock

* WORM (Write Once Read Many) protection.
* Retain data for compliance.
* Modes: Governance and Compliance.

---

### 🧾 S3 Select & Glacier Select

* Run SQL queries on objects directly (CSV, JSON, Parquet).
* Saves cost by retrieving only the data needed.

---

### 🧠 S3 Best Practices (Exam-Relevant)

* Always use **Lifecycle Policies** to reduce cost.
* Enable **versioning** and **MFA Delete** for important data.
* Use **S3 Transfer Acceleration** for global uploads.
* Combine **S3 + CloudFront** for performance and security.
* Use **S3 Select** for analytics on large datasets.
* Prefer **IAM roles/policies** over bucket policies unless cross-account access is needed.
* Always **block public access** unless hosting a public static site.
* Use **encryption at rest** (SSE-KMS) and in transit (HTTPS).
* Enable **Access Logs** and **CloudTrail** for auditing.
* Know the **difference between storage classes**, especially Intelligent-Tiering and Glacier.



# 🪣 S3 Buckets – Deep Dive

---

#### 🧱 What Is a Bucket?

* A **bucket** is the top-level container for storing S3 objects.
* Every object is stored in a bucket and identified by a **key** (filename).
* Bucket names must be **globally unique** (across all AWS accounts and regions).
* You define the **AWS Region** where the bucket physically resides (data locality, latency, cost).

---

#### 📛 Bucket Naming Rules

* Must be **DNS-compliant** (lowercase, no underscores, 3–63 characters).
* Cannot be formatted like IP addresses (e.g., `192.168.5.4`).
* Best practice: use **domain-style names** (e.g., `mycompany-logs-prod`).

---

#### 🌍 Bucket Region

* You choose a region at bucket creation. It determines:

  * Latency
  * Storage costs
  * Compliance/data residency
* Data does not automatically replicate to other regions.

---

#### 📁 Folder Structure (Pseudo-Folders)

* S3 does not have real folders; the folder hierarchy is part of the object key.

  * Example key: `logs/2025/08/07/file.json`
* S3 console shows “folders” by parsing `/` in keys.

---

#### 🔐 Bucket Access Control

* **Block Public Access (recommended)**:

  * Can be applied account-wide or per-bucket.
  * Prevents unintended public exposure.
* **Bucket Policy**:

  * JSON-based resource policy.
  * Allows/denies access based on conditions (IP, VPC, user, etc.).
* **ACL (Access Control List)**:

  * Legacy mechanism.
  * Grants individual permissions to users or AWS accounts.
* **IAM Policies**:

  * Define permissions per user/role/group.
  * More scalable and secure than ACLs.

---

#### 🛡️ Bucket Encryption Options

* Default encryption can be configured at the bucket level:

  * SSE-S3
  * SSE-KMS (recommended for auditability via KMS)
  * SSE-C (you manage keys)
* All new objects uploaded are automatically encrypted.

---

#### 📄 Bucket Versioning

* Enables **object versioning** (keeps previous versions).
* Needed for:

  * **Cross-region replication**
  * **MFA delete**
  * Protection against accidental deletions/overwrites.

---

#### 🔄 Bucket Replication

* Requires versioning enabled.
* Use cases:

  * Cross-region backup
  * Compliance
  * Aggregation from multiple buckets

---

#### 🔍 Bucket Logging

* **Server Access Logging**:

  * Delivers detailed request logs to another S3 bucket.
* Useful for auditing and troubleshooting access.

---

#### 🧠 Bucket Policies – Common Examples

```json
// Deny access unless using HTTPS
{
  "Effect": "Deny",
  "Principal": "*",
  "Action": "s3:*",
  "Resource": ["arn:aws:s3:::mybucket", "arn:aws:s3:::mybucket/*"],
  "Condition": {
    "Bool": { "aws:SecureTransport": "false" }
  }
}
```

```json
// Allow read-only access from a specific IP range
{
  "Effect": "Allow",
  "Principal": "*",
  "Action": ["s3:GetObject"],
  "Resource": ["arn:aws:s3:::mybucket/*"],
  "Condition": {
    "IpAddress": { "aws:SourceIp": "203.0.113.0/24" }
  }
}
```

---

#### 💡 SAA Exam Tips – Bucket Focus

* Know how **bucket policies**, **IAM**, and **Block Public Access** work together.
* Understand **replication**, especially requirements like versioning.
* Be able to troubleshoot access issues: blocked by BPA, wrong region, IAM denied, etc.
* Know when to use **static website hosting** and its impact on public access.
* Encryption defaults can be enforced **per-bucket** (important for compliance).


# 🧱 Objects and Keys (Extended Deep Dive)

#### 🔸 Object Components:

Every object stored in S3 consists of:

* **Key**: Unique identifier (like a file path).
* **Data**: The content (up to 5 TB max per object).
* **Metadata**:

  * **System-defined** (e.g., `Content-Type`, `Last-Modified`, `ETag`, `Content-Length`)
  * **User-defined** (custom tags or headers)
* **Version ID**: When versioning is enabled.
* **Access Control Information**:

  * Set via ACLs (not recommended now), Bucket Policies, or IAM.

#### 🔸 Object Key Details:

* The key is the full "path" (e.g., `folder1/folder2/file.txt`)—S3 doesn't have real folders.
* This structure enables **prefix-based operations** like filtering or lifecycle policies.
* Important for **performance optimization**: Using **randomized prefixes** improves parallelization.

#### 🔸 Object URLs:

* Accessed via:
  `https://<bucket-name>.s3.<region>.amazonaws.com/<key>`

#### 🔸 Object Versioning:

* **Enabling versioning**:

  * Makes S3 keep all versions of an object (including deletes).
* **Delete markers**:

  * Placed on delete, but previous versions are retained.
* **Suspending versioning** doesn't remove existing versions but stops new versions from being tracked.

#### 🔸 Object Lock:

* Enforce WORM (Write Once Read Many) compliance.
* Use cases: financial records, legal documents.
* Supports **retention periods** and **legal holds**.

---

### 🗃️ Storage Classes (Extended Deep Dive)

| Storage Class                  | Availability | Durability | Retrieval Time   | Min Duration         | Use Case                               |
| ------------------------------ | ------------ | ---------- | ---------------- | -------------------- | -------------------------------------- |
| **Standard**                   | 99.99%       | 11 9s      | Instant          | None                 | Hot data, frequent access              |
| **Intelligent-Tiering**        | 99.9%        | 11 9s      | Instant          | 30 days (some tiers) | Unknown/variable access patterns       |
| **Standard-IA**                | 99.9%        | 11 9s      | Instant          | 30 days              | Infrequently accessed, critical        |
| **One Zone-IA**                | 99.5%        | 11 9s      | Instant          | 30 days              | Infrequently accessed, non-critical    |
| **Glacier Instant Retrieval**  | 99.9%        | 11 9s      | Millisecond      | 90 days              | Archive with fast occasional retrieval |
| **Glacier Flexible Retrieval** | 99.9%        | 11 9s      | Minutes to hours | 90 days              | Archive with flexible cost/time        |
| **Glacier Deep Archive**       | 99.9%        | 11 9s      | Up to 12 hrs     | 180 days             | Long-term archive, compliance data     |

#### 🔸 Additional Notes:

* **Object can be transitioned** between storage classes via **Lifecycle Rules**.
* **Restore operation** is needed for Glacier and Deep Archive before access.
* **Standard vs IA**:

  * IA has lower storage cost but **higher retrieval cost**.
  * Minimum storage duration applies (e.g., 30 days for IA).
* **Glacier Retrieval Options**:

  * **Expedited**: 1–5 min (only for small data, limited capacity).
  * **Standard**: Few hours.
  * **Bulk**: 5–12 hours, cheapest.

#### 🔸 Intelligent-Tiering Auto-Tiers:

* Frequent Access
* Infrequent Access
* Archive Instant Access
* Archive Deep Archive Access

> 🎯 **Exam Tip**: You won’t be asked about prices, but **minimum storage duration**, **retrieval latency**, and **appropriate use cases** are heavily tested.


# 🔐 Security & Access Control

#### 🔑 1. **Access Management Options**

S3 provides multiple layers of access control to ensure data security:

* **IAM Policies** (User/Role level)

  * Define who (IAM user/role) can access which S3 resources.
  * Applied to IAM users, groups, or roles.
  * Use JSON syntax and include `Action`, `Effect`, `Resource`, `Condition`.

* **Bucket Policies** (Resource-level)

  * JSON-based policies attached directly to a bucket.
  * Can grant cross-account or anonymous access.
  * Use with caution — always apply least privilege principle.

* **ACLs (Access Control Lists)** (Legacy)

  * Object-level permissions.
  * Not recommended for fine-grained control; use IAM/Bucket Policies instead.
  * Still required for granting access to AWS accounts without IAM.

* **S3 Access Points**

  * Simplify access management for shared datasets.
  * Create unique access permissions for each app/user.

---

#### 🔐 2. **Public Access Block Settings**

Global S3 setting to avoid accidental exposure:

* **BlockPublicAcls** – Blocks public ACLs on objects.
* **IgnorePublicAcls** – Ignores any public ACLs present.
* **BlockPublicPolicy** – Prevents bucket policies that allow public access.
* **RestrictPublicBuckets** – Restricts public access, even if policies allow.

**Best Practice**: Enable all four by default.

---

#### 🔐 3. **Encryption Options**

* **Server-Side Encryption (SSE)**:

  * **SSE-S3** – AWS manages keys.
  * **SSE-KMS** – AWS KMS key; more control + audit trail.
  * **SSE-C** – Customer provides their own key (rare).

* **Client-Side Encryption**:

  * Encrypt before sending to S3.
  * You manage both keys and encryption logic.

---

#### 🔐 4. **Pre-Signed URLs**

* Grant temporary, limited access to a private object.
* Generated using AWS SDK/CLI.
* Useful for download/upload access without modifying bucket policies.

---

#### 🔐 5. **Logging and Monitoring**

* **S3 Server Access Logs** – Records every request made to your S3 bucket.
* **CloudTrail** – Audits all API activity related to S3.
* **AWS Config** – Monitors configuration changes (e.g., public access).
* **AWS Trusted Advisor** – Flags publicly accessible buckets.

---

#### 💡 Security Tips for SAA Exam

* Always enable **Block Public Access** unless explicitly required.
* Use **SSE-KMS** for compliance-sensitive workloads.
* **Pre-signed URLs** are ideal for temporary, secure object access.
* Bucket policies support **conditions** (e.g., IP-based access, MFA).
* Never expose secrets or credentials via bucket objects.

# ✅ **1. Versioning**

**What:**
S3 Versioning allows you to preserve, retrieve, and restore **every version of every object** stored in a bucket.

**Why it's important:**

* Protects against accidental deletions or overwrites.
* Supports **object recovery**.
* Useful in regulated environments where data must be retained.

**How it works:**

* When versioning is enabled, each object gets a unique version ID.
* Deleting an object creates a **delete marker**, but older versions still exist.
* Can be used with **Lifecycle Policies** to archive/delete specific versions.

> 🔐 Works well with Object Lock for legal holds or WORM (Write Once, Read Many).

---

### 📢 **2. S3 Event Notifications**

**What:**
Automatically trigger events (via **SNS**, **SQS**, or **AWS Lambda**) on object-level operations such as uploads, deletes, etc.

**Why it's important:**

* Enables automation: e.g., image resizing, virus scanning, data processing.
* Event-driven architecture.

**How it works:**

* Events: `s3:ObjectCreated:*`, `s3:ObjectRemoved:*`, etc.
* Configure through bucket properties or AWS CLI.

> 📌 Use Lambda for seamless serverless integration on object upload.

---

### 📊 **3. Logging & Monitoring**

**What:**
Monitor who accesses your data and how your bucket is being used.

**Types:**

* **Server Access Logging**: Writes logs of requests to another S3 bucket.
* **AWS CloudTrail**: Logs all S3 API calls (PUT, GET, DELETE).
* **Amazon CloudWatch**: Monitors S3 metrics like number of requests, errors, latency.

**Why it's important:**

* Essential for **audit**, **security**, and **compliance**.
* Helps troubleshoot issues or detect misuse.

> 🔐 Enable logs in **another bucket** (not the same one) to avoid recursion.

---

### 🌐 **4. S3 Static Website Hosting**

**What:**
Allows you to host static web content (HTML, JS, CSS) directly from S3.

**How it helps:**

* No need for web servers or EC2.
* Cost-effective and scalable.
* Ideal for SPAs (Single Page Apps), documentation, portfolios.

**How it works:**

* Enable “Static Website Hosting” in bucket settings.
* Upload your HTML, set index and error documents.
* Public read access (or use **CloudFront** for better control and HTTPS).
* Access site via `http://<bucket-name>.s3-website-<region>.amazonaws.com`.

> ⚠️ Use **CloudFront + S3** for HTTPS support and better performance.

---

### 📍 **5. S3 Access Points**

**What:**
Access Points allow you to create **customized access** to S3 buckets for different applications or users.

**Why it's useful:**

* Simplifies access management in multi-tenant or shared datasets.
* Each access point has its own **policy** and **DNS endpoint**.

**How it works:**

* You define name, VPC restrictions, and policies.
* Can limit access to a prefix (e.g., `/user1/*`) within a bucket.

> 🚀 Scales better in environments with complex access needs.

---

### 🔁 **6. S3 Replication (CRR & SRR)**

**What:**
Replicates objects from one bucket to another — **Cross-Region (CRR)** or **Same-Region (SRR)**.

**Why it’s useful:**

* **Disaster recovery** (CRR).
* **Compliance** (data stored in another region).
* **Data localization**.
* **Log aggregation** from multiple regions.

**How it works:**

* Versioning must be **enabled** on both source and destination.
* IAM role needed with replication permissions.
* You can filter by prefix or tags.
* **Replicates new objects only** (not retroactive unless using Batch Operations).
* Optionally replicates **delete markers**, **metadata**, and **ACLs**.

> 🧠 You can also replicate encrypted objects (SSE-S3/SSE-KMS).

---

### 🔐 **7. S3 Object Lock**

**What:**
Prevents object versions from being deleted or overwritten for a **fixed** or **indefinite** period.

**Why it’s important:**

* Ensures **data immutability**.
* Meets **compliance** standards like SEC 17a-4(f), FINRA, HIPAA.
* Supports **legal holds** and **governance**.

**Modes:**

* **Governance Mode**: Protected, but privileged users can override.
* **Compliance Mode**: Absolute lock — even admins cannot delete.

**Retention:**

* Set by time-based policy or legal hold.

> 🔒 Combine with **Versioning** and **MFA Delete** for maximum protection.
