# Auto Scaling Groups (ASG) ‚Äì Deep Dive for AWS SAA Certification

---

### 1. **What is Auto Scaling?**

Auto Scaling automatically adjusts the number of EC2 instances in response to load. It helps maintain application availability and reduce cost.

---

### 2. **Key Components**

* **Launch Template / Launch Configuration:**

  * Specifies AMI, instance type, key pair, security groups, etc.
  * **Launch Templates** are preferred over Launch Configurations (support versioning, more features).

* **Auto Scaling Group (ASG):**

  * Defines:

    * Minimum, Maximum, and Desired number of instances
    * Availability Zones
    * Scaling policies
    * Health checks
    * Load balancers (ELB/ALB/NLB)

* **Scaling Policies:**

  * **Dynamic Scaling:** Adjusts based on CloudWatch alarms (e.g., CPU > 70%).
  * **Target Tracking Scaling:** Keeps a metric (e.g., CPU) at a target value.
  * **Step Scaling:** Scales in steps based on threshold ranges.
  * **Scheduled Scaling:** Scale based on predictable schedule (e.g., scale up every day at 9AM).

* **Lifecycle Hooks:**

  * Add custom actions during instance launch or termination (e.g., configure software, drain connections).

* **Health Checks:**

  * Performed by EC2 and/or ELB.
  * Unhealthy instances are terminated and replaced automatically.

---

### 3. **How ASG Works**

* Define a Launch Template.
* Attach it to an ASG.
* ASG launches instances based on desired capacity and replaces them if they become unhealthy.
* ASG can span multiple AZs for HA.

---

### 4. **Benefits of ASG**

* High Availability
* Fault Tolerance
* Cost Optimization (scale in during low demand)
* Automation

---

### 5. **Integration with Load Balancer**

* Register ASG with **ALB, NLB, or Classic ELB**.
* ELB distributes traffic to healthy instances in the ASG.
* ELB health checks can trigger ASG to replace instances.

---

### 6. **CloudWatch Integration**

* Use CloudWatch metrics (CPU, RAM, Custom) to trigger scaling.
* Create alarms for auto scale out/in.

---

### 7. **Elasticity and Predictive Scaling**

* **Elasticity:** Automatically adjust resources in response to demand.
* **Predictive Scaling:** Uses ML to forecast traffic and scale proactively.

---

### 8. **Termination Policies**

Controls which instance is terminated first during scale-in:

* OldestInstance
* NewestInstance
* ClosestToNextInstanceHour
* Default: Random

---

### 9. **Instance Refresh**

* Rolling replacement of instances in ASG (used during AMI updates).
* Maintains capacity and availability.

---

### 10. **Warm Pools (Optional)**

* Pre-initialize instances in stopped state for faster scale-out.

---

### 11. **Common Scenarios in Exam**

* Scale EC2 instances based on CPU.
* Replace failed instances automatically.
* Integrate with ALB for traffic routing.
* Lifecycle hook to run setup scripts.
* Scheduled scaling for known peak times.

---

### 12. **Best Practices**

* Use multiple AZs for HA.
* Use Launch Templates instead of Launch Configs.
* Enable health checks.
* Integrate with CloudWatch.
* Secure instances with IAM roles and SGs.
* Monitor scaling activity and cost.
---

# Additional Page ‚Äî CLI, Diagrams & Troubleshooting

## üîß CLI Commands

**Create Auto Scaling Group:**

```bash
aws autoscaling create-auto-scaling-group \
  --auto-scaling-group-name my-asg \
  --launch-template LaunchTemplateName=my-template,Version=1 \
  --min-size 1 --max-size 3 --desired-capacity 2 \
  --vpc-zone-identifier subnet-abc123,subnet-def456
```

**Attach to Load Balancer:**

```bash
aws autoscaling attach-load-balancer-target-groups \
  --auto-scaling-group-name my-asg \
  --target-group-arns arn:aws:elasticloadbalancing:...
```

**Put Lifecycle Hook:**

```bash
aws autoscaling put-lifecycle-hook \
  --lifecycle-hook-name my-launch-hook \
  --auto-scaling-group-name my-asg \
  --lifecycle-transition autoscaling:EC2_INSTANCE_LAUNCHING \
  --heartbeat-timeout 300
```

---

## üß† Troubleshooting Tips

### 1. ASG Not Launching Instances

* Check IAM role permissions
* Ensure subnets have capacity
* Review scaling policies and health checks

### 2. Instances Terminate Immediately

* Failing ELB health checks
* EC2 UserData or app crashes
* Incorrect AMI or config

### 3. ASG Not Scaling

* CloudWatch alarms not triggering
* Scaling cooldowns too long
* Wrong metric/dimension used

### 4. Lifecycle Hooks Timing Out

* App setup takes longer than heartbeat timeout
* Hook not completed via script or CLI

---

## üìä Diagram ‚Äî ASG Lifecycle Flow

```
User ‚Üí Create ASG
     ‚Üí ASG uses Launch Template to start EC2
         ‚Üí Lifecycle Hook (optional pause)
             ‚Üí EC2 instance starts up
                 ‚Üí Passes health checks
                     ‚Üí Added to ELB (if configured)

     ‚Üê CloudWatch alarm triggers scaling
         ‚Üí ASG adds/removes EC2s
             ‚Üí Lifecycle hooks apply (launch/terminate)
```

