# AWS Secrets Manager

## Overview

AWS Secrets Manager is a fully managed service designed to help securely store, manage, and retrieve secrets such as database credentials, API keys, tokens, and other sensitive configuration data. It integrates with other AWS services, supports automatic rotation, fine-grained access control, and audit logging.

---

## Core Features

### 1. **Secure Secret Storage**

* Stores encrypted secrets using AWS Key Management Service (KMS).
* Secrets are encrypted at rest and in transit.

### 2. **Automatic Rotation**

* Supports automatic rotation for AWS RDS, Redshift, and other supported services.
* Lambda functions can be customized for secret rotation.

### 3. **Fine-Grained Access Control**

* Integrated with IAM policies for access control.
* Supports resource-based policies to restrict access to specific secrets.

### 4. **Audit Logging**

* Integrated with AWS CloudTrail to track secret access, creation, deletion, and rotation.

### 5. **Cross-Account Access**

* Secrets can be accessed across AWS accounts using resource policies.

---

## Use Cases

* Storing database credentials.
* Managing API keys and tokens securely.
* Automating secret rotation.
* Sharing secrets across microservices.
* Limiting blast radius of leaked credentials.

---

## How It Works

1. **Create a Secret**

   * Provide a key-value pair (e.g., username/password).
   * Choose encryption key (default or custom KMS key).

2. **Access the Secret**

   * Applications use AWS SDK/CLI or Secrets Manager API.
   * IAM role or user permissions control who can access it.

3. **Rotate the Secret**

   * Enable automatic rotation.
   * Provide a Lambda function to handle the rotation logic.

---

## Security

### 1. **Encryption with AWS KMS**

* Secrets are encrypted at rest using customer-managed or AWS-managed KMS keys.

### 2. **IAM Access Policies**

* Control access using IAM roles and policies.
* Example: Restrict access to specific EC2 or Lambda functions.

### 3. **Resource Policies**

* Allow cross-account access securely.

### 4. **CloudTrail Logging**

* All actions related to secrets are logged in CloudTrail for auditing.

---

## Integration Examples

### Example 1: Using in Lambda (Python)

```python
import boto3
import json
import os

secrets_client = boto3.client('secretsmanager')

def get_secret(secret_name):
    response = secrets_client.get_secret_value(SecretId=secret_name)
    secret = json.loads(response['SecretString'])
    return secret

# Usage
secret = get_secret('my-database-secret')
username = secret['username']
password = secret['password']
```

### Example 2: IRSA (IAM Roles for Service Accounts) in EKS

* Bind Kubernetes ServiceAccount to an IAM role with SecretsManager permission.
* Mount secrets in pod environment using sidecar or init containers.

---

## Best Practices Checklist

* Enable automatic rotation for all supported secrets.
* Use least privilege IAM policies.
* Enable CloudTrail for audit logging.
* Use customer-managed KMS keys for greater control.
* Avoid hardcoding secrets in code; use environment variables or secret references.
* Review secret usage with AWS Config rules.

---

## Cost Considerations

* \$0.40 per secret per month.
* \$0.05 per 10,000 API calls.
* Rotating secrets using Lambda incurs standard Lambda and Secrets Manager charges.

---

## Comparison with AWS Parameter Store

| Feature              | Secrets Manager    | Parameter Store       |
| -------------------- | ------------------ | --------------------- |
| Secret Rotation      | ✓ Built-in support | ✗ Manual              |
| Cost                 | Higher             | Lower (free for std.) |
| API Call Cost        | \$0.05/10K calls   | Free for standard     |
| KMS Encryption       | ✓                  | ✓                     |
| Cross-account Access | ✓                  | ✓                     |
| Audit via CloudTrail | ✓                  | ✓                     |

---

## Summary

AWS Secrets Manager is a critical tool for DevOps engineers and cloud developers aiming to manage secrets securely and scalably. Its support for automated rotation, tight integration with IAM, and audit capabilities make it ideal for production workloads.
